<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<canvas id="canvas" width="800" height="450" style="border: 1px dashed gray;"></canvas>
<button  id="light">亮度加</button>
</body>
<script type="application/javascript">
    window.onload = function (){
        const canvas = document.getElementById("canvas").getContext("2d");
        const light = document.getElementById("light");
        const img = new Image();
        img.src = "/images/2.jpg";
        img.onload = function (){
            canvas.drawImage(img,10,10);
            // 反转效果
            // getImageData(x,y,width,height) 获取图片的像素数据，里面data字段为像素数据数组
            // data中每4个数存储一个rgba颜色值，分别为红、绿、蓝、透明度
            let imgData = canvas.getImageData(10,10,150,200);
            let data = imgData.data;
            for(let i=0;i<data.length;i+=4){
                data[i] = 255 - data[i];
                data[i+1] = 255 - data[i+1];
                data[i+2] = 255 - data[i+2];
            }
            canvas.putImageData(imgData,160,10)
            //黑白效果，取平均值
            for(let i=0;i<data.length;i+=4){
                const average = (data[i] + data[i+1] + data[i+2])/3;
                data[i] = data[i+1] = data[i+2] = average;
            }
            canvas.putImageData(imgData,320,10)
            // 亮度效果,将三个颜色值分别同时加减一个值
            light.onclick = function (){
                for(let i=0;i<data.length;i+=4){
                    data[i] +=1;
                    data[i+1] +=1;
                    data[i+2] +=1;
                }
                canvas.putImageData(imgData,320,10)
            }
            // 复古效果，分别取三个颜色某种加权平均值
            function sepia(){
                let imgData = canvas.getImageData(10,10,150,200);
                let data = imgData.data;
                for(let i=0;i<data.length;i+=4){
                    let r = data[i];
                    let g = data[i+1];
                    let b = data[i+2];
                    data[i] = r*0.39 + g*0.76 + b*0.18;
                    data[i+1] = r*0.35 + g*0.68 + b*0.16;
                    data[i+2] = r*0.27 + g*0.53 + b*0.13;
                }
                canvas.putImageData(imgData,480,10)
            }
            sepia();
            // 蒙版,红色蒙版：取三个夜色平均值付给红色，绿色和蓝色设置为0
            function mask(){
                const imgData = canvas.getImageData(10,10,150,200);
                const data = imgData.data;
                for(let i = 0;i < data.length;i+=4){
                    const average = (data[i] + data[i+1] + data[i+2])/3;
                    data[i] = average;
                    data[i+1] = 0;
                    data[i+2] = 0
                }
                canvas.putImageData(imgData,640,10)
            };
            mask();
            // 透明度处理,透明度值分别乘n
            function opacity(){
                const imgData = canvas.getImageData(10,10,150,200);
                const data = imgData.data;
                for(let i = 0;i < data.length;i+=4){
                    data[i+3] = data[i+3]*0.6
                }
                canvas.putImageData(imgData,10,210)
            }
            opacity();
            // createImageData()
            // createImageData(sw,sh),参数表示要创建区域的宽度和高度
            // createImageData(imageData),参数表示要创建区域的狂傲和参数对象一致
            function createImageData(){
                const imgData = canvas.getImageData(10,10,150,200);
                console.log(imgData);
                const imgData1 = canvas.createImageData(imgData);
                const data = imgData1.data;
                for(let i = 0;i < imgData1.width*imgData1.height*4;i+=4){
                    data[i] = 0;
                    data[i+1] = 0;
                    data[i+2] = 255;
                    data[i+3] = 255
                }
                canvas.putImageData(imgData1,160,210)
            }
            createImageData();
        }
    }
</script>
</html>